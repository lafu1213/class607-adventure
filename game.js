// ==========================================
//  0. æ¸¬è©¦å€ (ç¢ºèªç¨‹å¼æœ‰è·‘)
// ==========================================
console.log("Game.js è¼‰å…¥æˆåŠŸï¼");

// ==========================================
//  1. è¨­å®šå€
// ==========================================
// é€™æ˜¯æ‚¨è²¼çµ¦æˆ‘çš„æ­£ç¢ºç¶²å€ï¼Œæˆ‘å·²ç¶“å¹«æ‚¨å¡«å¥½äº†
const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxy2_inueBSmZpQsuUQ32DYe3VnCuDqr3B9mba0wVHISTm4fP-4sztmslYaP35eyRnUwA/exec"; 

// ==========================================
//  2. é¡Œåº«å€ (Data Layer)
// ==========================================
const questionBank = {
    chinese: [
        { q: "æ„›çˆ¾è˜­ä½œå®¶ç‹çˆ¾å¾·æ›¾èªªéå“ªä¸€å¥è©±ï¼Œç”¨ä¾†æ¯”å–»æ¢ç´¢äººç”Ÿæ„ç¾©çš„é‘°åŒ™ï¼Ÿ", options: ["ç”Ÿæ´»çš„å¥§ç¥•å­˜åœ¨æ–¼è—è¡“ä¹‹ä¸­", "è—è¡“æ˜¯ç”Ÿæ´»çš„å”¯ä¸€å°å¸«", "è®€è¬å·æ›¸ä¸å¦‚è¡Œè¬é‡Œè·¯", "æƒ³åƒåŠ›æ¯”çŸ¥è­˜æ›´é‡è¦"], ans: 0 }, 
        { q: "æ ¹æ“šä¾†æºï¼Œç‹çˆ¾å¾·ç‚ºä»–çš„å…©å€‹å…’å­å¯«äº†å“ªä¸€æœ¬è‘—åçš„æ•…äº‹é›†ï¼Ÿ", options: ["å·¨äººçš„èŠ±åœ’", "å¿«æ¨‚ç‹å­å’Œå…¶ä»–æ•…äº‹é›†", "æ£®æ—ç‹å­", "æ˜Ÿæ˜Ÿä¹‹å­"], ans: 1 }, 
        { q: "ç¬¬ä¸ƒèª²ã€Šè·Ÿè‘—å…¬å…±è—è¡“å»æ—…è¡Œã€‹çš„ä½œè€…æ˜¯èª°ï¼Ÿ", options: ["æ¥Šè‹±é¢¨", "é¦¬å›è¼”", "å¼µè‚²é›¯", "æœ±éŠ˜"], ans: 2 }, 
        { q: "å…¬å…±è—è¡“ï¼ˆPublic Artï¼‰å¿…é ˆå…·å‚™å“ªå…©é …ç‰¹é»ï¼Ÿ", options: ["å¯¦ç”¨æ€§èˆ‡ç¾è§€æ€§", "å…¬å…±æ€§èˆ‡è—è¡“æ€§", "æ­·å²æ€§èˆ‡æ•™è‚²æ€§", "è¶£å‘³æ€§èˆ‡äº’å‹•æ€§"], ans: 1 }, 
        { q: "ä¸»è§’è·Ÿå®¶äººé–‹å§‹é€™è¶Ÿã€Œå…¬å…±è—è¡“ä¹‹æ—…ã€çš„ä¸»è¦åŸå› æ˜¯ä»€éº¼ï¼Ÿ", options: ["å› ç‚ºå­¸æ ¡ä½œæ¥­çš„è¦æ±‚", "å› ç‚ºçœ‹å®Œç•«å±•æƒ³å»æ•£å¿ƒ", "å› ç‚ºè½å®Œé˜¿å§¨åˆ†äº«å¾Œå°å…¬å…±è—è¡“æ„Ÿåˆ°å¥½å¥‡", "å› ç‚ºæƒ³å»ç¾è¡“é¤¨å¹å†·æ°£"], ans: 2 }, 
        { q: "ä½œå“ã€Šå¤§åœ°ä¹‹æ›¸ã€‹æ˜¯å°‡ä»€éº¼æ±è¥¿çš„ç´°éƒ¨ç´‹ç†å°å­˜åœ¨é’éŠ…é›•å¡‘è£¡ï¼Ÿ", options: ["æ˜†èŸ²çš„ç¿…è†€", "è‡ºç£åŸç”Ÿæ¤ç‰©çš„è‘‰å­ã€ç¨®å­å’ŒèŠ±æœµ", "æ­·ä»£åå®¶çš„æ›¸æ³•æ‹“æœ¬", "æµ·é‚Šçš„è²æ®¼èˆ‡æ²™ç¤«"], ans: 1 }, 
        { q: "åœ¨å˜‰ç¾©è§¸å£éŠå®¢ä¸­å¿ƒçœ‹åˆ°çš„ã€ŠèŠ±é–“å°é¹¿ã€‹ï¼Œå…¶é¹¿è§’å‘ˆç¾ä»€éº¼æ¨£çš„å¤–è§€ï¼Ÿ", options: ["åƒçŠç‘šèˆ¬çš„åˆ†å‰", "åƒæ¨¹æèˆ¬æ˜‚æš", "åƒé‡‘å±¬ç‰‡çš„å †ç–Š", "åƒèŠ±è‹èˆ¬å«æ”¾"], ans: 1 }, 
        { q: "ã€ŠèŠ±é–“å°é¹¿ã€‹é€™ä»¶ä½œå“æƒ³è¦å‚³éå“ªä¸€å€‹åŸä½æ°‘æ—çš„çµé¹¿å‚³èªªï¼Ÿ", options: ["æ³°é›…æ—", "é˜¿ç¾æ—", "é„’æ—", "æ’ç£æ—"], ans: 2 }, 
        { q: "æ ¹æ“šã€Œæ–‡åŒ–è—è¡“çåŠ©åŠä¿ƒé€²æ¢ä¾‹ã€ï¼Œé‡å¤§å…¬å…±å·¥ç¨‹æ‡‰è¨­ç½®å…¬å…±è—è¡“ï¼Œå…¶ç¶“è²»ä¸å¾—å°‘æ–¼å·¥ç¨‹é€ åƒ¹çš„å¤šå°‘ï¼Ÿ", options: ["ç™¾åˆ†ä¹‹äº”", "ç™¾åˆ†ä¹‹ä¸€", "ç™¾åˆ†ä¹‹å", "ç™¾åˆ†ä¹‹ä¸‰"], ans: 1 }, 
        { q: "ä½œå“ã€Šåˆ†åˆéš¨ç·£ã€‹æ˜¯å“ªä¸€ä½è—è¡“å®¶çš„å‰µä½œï¼Ÿ", options: ["ç¬ åŸç”±èµ·å­", "æ¥Šè‹±é¢¨", "æœ±éŠ˜", "è³´äº­çŸ"], ans: 1 }, 
        { q: "é—œæ–¼ä½œå“ã€Šåˆ†åˆéš¨ç·£ã€‹çš„ç‰¹è‰²ï¼Œä¸‹åˆ—æ•˜è¿°ä½•è€…æ­£ç¢ºï¼Ÿ", options: ["æ˜¯ä¸€ä»¶æœ¨é›•ä½œå“", "å½±åƒæœƒéš¨è‘—è§€è³è§’åº¦çš„ä¸åŒè€Œç”¢ç”Ÿè®ŠåŒ–", "ä½œå“ç›®å‰è¨­ç½®åœ¨è‡ºåŒ—å¸‚ç«‹ç¾è¡“é¤¨", "æ˜¯ä¸€ä»¶å™´æ¼†å½©ç¹ªä½œå“"], ans: 1 }, 
        { q: "ä½œè€…æåˆ°ç¾è¡“é¤¨å…§çš„åƒè§€ç¦®å„€ï¼Œçˆ¸çˆ¸ç‰¹åˆ¥å®å›‘ä¸»è§’è¦å¦‚ä½•ï¼Ÿ", options: ["è¸´èºç™¼å•", "è¼•è²ç´°èª", "ç›¡æƒ…æ‹ç…§", "å¿«é€Ÿé€šé"], ans: 1 }, 
        { q: "ä¸‹åˆ—å“ªä¸€å€‹è©èªå¯ä»¥ç”¨ä¾†å½¢å®¹ã€Œäº”å½©ç¹½ç´›ã€ç¹è¯ç¾éº—ã€çš„æ¨£å­ï¼Ÿ", options: ["é›•èŸ²å°æŠ€", "ç•¥çŸ¥çš®æ¯›", "èŠ±åœ˜éŒ¦ç°‡", "è¡£éŒ¦é‚„é„‰"], ans: 2 }, 
        { q: "ã€Œä¸€â–¡çœ¼ï¼Œå¤ç‰©è—è¡“å“å·²ç¶“æµå‚³åƒå¹´ä¹‹ä¹…ã€‚ã€ç©ºæ ¼ä¸­æ‡‰å¡«å…¥å“ªå€‹å­—ï¼Ÿ", options: ["ç‚¸", "çœ¨", "çœ¨", "è²¶"], ans: 1 }, 
        { q: "ã€Œç‚ºäº†ç ”ç©¶çŸ³ç¢‘ä¸Šçš„æ–‡å­—ï¼Œè€å¸«å¸¶è‘—å­¸ç”Ÿé€²è¡Œâ–¡å°ã€‚ã€ç©ºæ ¼ä¸­æ‡‰å¡«å…¥å“ªå€‹å­—ï¼Ÿ", options: ["æ‹“", "è¸", "æ‰˜", "æ‹“"], ans: 0 }, 
        { q: "æ–‡ä¸­æåˆ°ç¾ä»£è—è¡“çš„ç‰¹è‰²å¤§ç´„å‡ºç¾åœ¨äºŒåä¸–ç´€ï¼Œå…¶ä¸»è¦çš„ç‰¹è‰²ç‚ºä½•ï¼Ÿ", options: ["å¯«å¯¦ã€å·¥æ•´", "æŠ½è±¡ã€å¹»æƒ³", "å‚³çµ±ã€åš´è¬¹", "é®®è±”ã€è¯éº—"], ans: 1 }, 
        { q: "åœ¨é–±è®€æ¸¬é©—ä¸­ï¼Œä½œè€…æåˆ°æ¥Šè‹±é¢¨æœ‰ä¸€ä½éå¸¸å‡ºåçš„å­¸ç”Ÿæ˜¯èª°ï¼Ÿ", options: ["å³å¯¬ç€›", "é¦¬å¯â€§å¡è–©æ ¼è˜­", "æœ±éŠ˜", "å¼µè‚²é›¯"], ans: 2 }, 
        { q: "æœ±éŠ˜ç¾è¡“é¤¨ä¸­ï¼Œä½œè€…æåˆ°ä»–æœ€å–œæ­¡å“ªä¸€å€‹ç³»åˆ—çš„å‰µä½œï¼Ÿ", options: ["å¤§åœ°ç³»åˆ—", "å¤ªæ¥µç³»åˆ—", "äººé–“ç³»åˆ—", "æ£®æ—ç³»åˆ—"], ans: 1 }, 
        { q: "ä¸‹åˆ—å¥å‹é‹ç”¨ï¼Œä½•è€…å±¬æ–¼ã€Œå‡è¨­è¤‡å¥ã€ï¼Ÿ", options: ["ä¸€æ–¹é¢å¯ä»¥æ¬£è³è—è¡“ï¼Œå¦ä¸€æ–¹é¢å¯ä»¥å¢é•·è¦‹èã€‚", "åªè¦æœ‰å¿ƒï¼Œå°±èƒ½æˆåŠŸã€‚", "è‹¥æƒ³æ“æœ‰å¥åº·çš„èº«é«”ï¼Œå°±å¿…é ˆå¤šé‹å‹•ã€‚", "ä»–ä¸€é‚Šå”±æ­Œï¼Œä¸€é‚Šè·³èˆã€‚"], ans: 2 }, 
        { q: "ã€Œå½¢å®¹å¿½ç„¶å®Œå…¨æ˜ç™½ã€å¯ä»¥ç”¨å“ªä¸€å€‹æˆèªï¼Ÿ", options: ["æç„¶å¤§æ‚Ÿ", "éŠ…ç‰†éµå£", "ç«­æ¾¤è€Œæ¼", "å«è‹å¾…æ”¾"], ans: 0 }
    ],
    math: [],
    nature: [],
    social: [],
    english: [],
    eng1200: [],
    tang: [],
    lang_king: [],
    geo_king: [],

    // === çŸ¥è­˜ç‹æŒ‘æˆ°è³½å°ˆå€ ===
    king_geo: [
        { q: "è¢«ç¨±ç‚ºã€Œåƒæ¹–ä¹‹åœ‹ã€çš„æ˜¯å“ªä¸€å€‹åœ‹å®¶ï¼Ÿ", options: ["åŠ æ‹¿å¤§", "èŠ¬è˜­", "ç‘å£«", "ç´è¥¿è˜­"], ans: 1 },
        { q: "ä¸–ç•Œä¸Šæµ·æ‹”æœ€é«˜çš„å±±å³°æ˜¯å“ªä¸€åº§ï¼Ÿ", options: ["å–¬æˆˆé‡Œå³°", "è–æ¯å³°", "å¹²åŸç« å˜‰å³°", "æ´›å­å³°"], ans: 1 },
        { q: "å°ç£æœ€é•·çš„æ²³æµæ˜¯å“ªä¸€æ¢ï¼Ÿ", options: ["æ¿æ°´æºª", "é«˜å±æºª", "æ·¡æ°´æ²³", "å¤§ç”²æºª"], ans: 0 },
        { q: "ä¸‹åˆ—å“ªä¸€å€‹åŸå¸‚ä½æ–¼å—åŠçƒï¼Ÿ", options: ["æ±äº¬", "ç´ç´„", "é›ªæ¢¨", "å·´é»"], ans: 2 },
        { q: "ã€Œæ¥µå…‰ã€ä¸»è¦ç™¼ç”Ÿåœ¨åœ°çƒå¤§æ°£å±¤çš„å“ªä¸€å±¤ï¼Ÿ", options: ["å°æµå±¤", "å¹³æµå±¤", "ç†±å±¤", "ä¸­æ°£å±¤"], ans: 2 },
        { q: "ä¸–ç•Œä¸Šæœ€å¤§çš„æ²™æ¼ æ˜¯ï¼Ÿ", options: ["æ’’å“ˆæ‹‰æ²™æ¼ ", "æˆˆå£æ²™æ¼ ", "å—æ¥µæ²™æ¼ ", "é˜¿æ‹‰ä¼¯æ²™æ¼ "], ans: 2 },
        { q: "å°ç£æœ¬å³¶æœ€å—ç«¯çš„å²¬è§’æ˜¯ï¼Ÿ", options: ["å¯Œè²´è§’", "ä¸‰è²‚è§’", "éµé‘¾é¼»", "è²“é¼»é ­"], ans: 2 },
        { q: "ä¸‹åˆ—å“ªä¸€å€‹åœ‹å®¶ä¸å±¬æ–¼ã€Œæ­ç›Ÿã€æˆå“¡åœ‹ï¼Ÿ", options: ["å¾·åœ‹", "æ³•åœ‹", "è‹±åœ‹", "ç¾©å¤§åˆ©"], ans: 2 },
        { q: "äºé¦¬éœé›¨æ—æ©«è·¨çš„åœ‹å®¶ä¸­ï¼Œä½”åœ°é¢ç©æœ€å¤§çš„æ˜¯ï¼Ÿ", options: ["ç§˜é­¯", "å“¥å€«æ¯”äº", "å·´è¥¿", "å§”å…§ç‘æ‹‰"], ans: 2 },
        { q: "æ—¥æœ¬çš„æœ€é«˜å³°ã€Œå¯Œå£«å±±ã€æ©«è·¨å“ªå…©å€‹ç¸£ï¼Ÿ", options: ["æ±äº¬éƒ½èˆ‡ç¥å¥ˆå·ç¸£", "éœå²¡ç¸£èˆ‡å±±æ¢¨ç¸£", "é•·é‡ç¸£èˆ‡å²é˜œç¸£", "äº¬éƒ½åºœèˆ‡å¤§é˜ªåºœ"], ans: 1 }
    ],
    king_hist: [
        { q: "ä¸­åœ‹æ­·å²ä¸Šå”¯ä¸€çš„å¥³çš‡å¸æ˜¯èª°ï¼Ÿ", options: ["æ…ˆç¦§å¤ªå", "å‘‚å", "æ­¦å‰‡å¤©", "è•­çš‡å"], ans: 2 },
        { q: "æ–‡è—å¾©èˆˆé‹å‹•ç™¼æºæ–¼å“ªå€‹åœ‹å®¶ï¼Ÿ", options: ["è‹±åœ‹", "æ³•åœ‹", "ç¾©å¤§åˆ©", "å¸Œè‡˜"], ans: 2 },
        { q: "å°ç£ç¬¬ä¸€ä½æ°‘é¸ç¸½çµ±æ˜¯èª°ï¼Ÿ", options: ["è”£ç¶“åœ‹", "æç™»è¼", "é™³æ°´æ‰", "é¦¬è‹±ä¹"], ans: 1 },
        { q: "å¤åŸƒåŠäººå»ºé€ é‡‘å­—å¡”çš„ä¸»è¦ç”¨é€”æ˜¯ï¼Ÿ", options: ["ç¥å»Ÿ", "é™µå¢“", "ç³§å€‰", "è§€æ¸¬è‡º"], ans: 1 },
        { q: "ä¸‰åœ‹æ¼”ç¾©ä¸­ï¼Œã€Œéäº”é—œæ–¬å…­å°‡ã€çš„æ˜¯å“ªä½äººç‰©ï¼Ÿ", options: ["è¶™é›²", "å¼µé£›", "é—œç¾½", "é¦¬è¶…"], ans: 2 },
        { q: "å¥§é‹æœƒèµ·æºæ–¼å“ªä¸€å€‹å¤æ–‡æ˜ï¼Ÿ", options: ["å¤ç¾…é¦¬", "å¤åŸƒåŠ", "å¤å¸Œè‡˜", "å¤å·´æ¯”å€«"], ans: 2 },
        { q: "ã€Œå®‰å²ä¹‹äº‚ã€ç™¼ç”Ÿåœ¨ä¸­åœ‹å“ªä¸€å€‹æœä»£ï¼Ÿ", options: ["æ¼¢æœ", "å”æœ", "å®‹æœ", "æ˜æœ"], ans: 1 },
        { q: "ç¾åœ‹ç¨ç«‹å®£è¨€æ˜¯åœ¨å“ªä¸€å¹´ç°½ç½²çš„ï¼Ÿ", options: ["1776å¹´", "1789å¹´", "1865å¹´", "1901å¹´"], ans: 0 },
        { q: "è‘—åçš„å»ºç¯‰ã€Œæ³°å§¬ç‘ªå“ˆé™µã€ä½æ–¼å“ªå€‹åœ‹å®¶ï¼Ÿ", options: ["æ³°åœ‹", "å°å°¼", "å°åº¦", "åœŸè€³å…¶"], ans: 2 },
        { q: "å°ç£åŸä½æ°‘ä¸­ï¼Œä»¥ã€Œé£›é­šç¥­ã€èåçš„æ˜¯å“ªä¸€æ—ï¼Ÿ", options: ["é˜¿ç¾æ—", "æ’ç£æ—", "é”æ‚Ÿæ—", "æ³°é›…æ—"], ans: 2 }
    ],
    king_sci: [
        { q: "äººé«”æœ€å¤§çš„å™¨å®˜æ˜¯ä»€éº¼ï¼Ÿ", options: ["è‚è‡Ÿ", "è…¦", "çš®è†š", "è‚º"], ans: 2 },
        { q: "æ°´çš„åŒ–å­¸å¼æ˜¯ï¼Ÿ", options: ["HO2", "H2O", "CO2", "H2O2"], ans: 1 },
        { q: "å¤ªé™½ç³»ä¸­ï¼Œé«”ç©æœ€å¤§çš„è¡Œæ˜Ÿæ˜¯ï¼Ÿ", options: ["åœ°çƒ", "åœŸæ˜Ÿ", "æœ¨æ˜Ÿ", "å¤©ç‹æ˜Ÿ"], ans: 2 },
        { q: "å…‰åœ¨çœŸç©ºä¸­çš„é€Ÿåº¦å¤§ç´„æ˜¯æ¯ç§’å¤šå°‘å…¬é‡Œï¼Ÿ", options: ["3è¬", "30è¬", "300è¬", "3000è¬"], ans: 1 },
        { q: "ä¸‹åˆ—å“ªç¨®å‹•ç‰©ä¸æ˜¯å“ºä¹³é¡ï¼Ÿ", options: ["é¯¨é­š", "è™è ", "ä¼éµ", "æµ·è±š"], ans: 2 },
        { q: "å…ƒç´ é€±æœŸè¡¨ä¸­ï¼Œç¬¦è™Ÿã€ŒAuã€ä»£è¡¨ä»€éº¼å…ƒç´ ï¼Ÿ", options: ["éŠ€", "éŠ…", "é‡‘", "é‹"], ans: 2 },
        { q: "è² è²¬è¼¸é€äººé«”è¡€æ¶²é›¢é–‹å¿ƒè‡Ÿçš„è¡€ç®¡ç¨±ç‚ºï¼Ÿ", options: ["å‹•è„ˆ", "éœè„ˆ", "å¾®è¡€ç®¡", "æ·‹å·´ç®¡"], ans: 0 },
        { q: "åœ°çƒè‡ªè½‰ä¸€åœˆå¤§ç´„éœ€è¦å¤šä¹…ï¼Ÿ", options: ["ä¸€å€‹æœˆ", "ä¸€å¹´", "24å°æ™‚", "12å°æ™‚"], ans: 2 },
        { q: "é›»è…¦é‹ç®—çš„åŸºæœ¬å–®ä½æ˜¯ï¼Ÿ", options: ["Pixel", "Bit", "Volt", "Gram"], ans: 1 },
        { q: "ä¸‹åˆ—å“ªä¸€ç¨®æ°£é«”æ˜¯å°è‡´æº«å®¤æ•ˆæ‡‰çš„ä¸»è¦æ°£é«”ï¼Ÿ", options: ["æ°§æ°£", "æ°®æ°£", "äºŒæ°§åŒ–ç¢³", "æ°«æ°£"], ans: 2 }
    ],
    king_life: [
        { q: "ä¸€èˆ¬æˆäººå…±æœ‰å¤šå°‘é¡†æ†é½’ï¼ˆåŒ…å«æ™ºé½’ï¼‰ï¼Ÿ", options: ["28é¡†", "30é¡†", "32é¡†", "34é¡†"], ans: 2 },
        { q: "å¥§æ—åŒ¹å…‹é‹å‹•æœƒçš„äº”ç’°æ¨™èªŒä¸­ï¼Œä¸åŒ…å«ä¸‹åˆ—å“ªç¨®é¡è‰²ï¼Ÿ", options: ["é»ƒè‰²", "é»‘è‰²", "ç´«è‰²", "ç¶ è‰²"], ans: 2 },
        { q: "æ¨™æº–é‹¼ç´å…±æœ‰å¹¾å€‹ç´éµï¼Ÿ", options: ["66éµ", "88éµ", "92éµ", "100éµ"], ans: 1 },
        { q: "åœ¨äº¤é€šè™ŸèªŒä¸­ï¼Œå€’ä¸‰è§’å½¢çš„æ¨™èªŒé€šå¸¸ä»£è¡¨ä»€éº¼æ„æ€ï¼Ÿ", options: ["ç¦æ­¢é€šè¡Œ", "è®“è·¯", "åœè»Šå†é–‹", "æ­¤è·¯ä¸é€š"], ans: 1 },
        { q: "æ’²å…‹ç‰Œä¸­ï¼Œå”¯ä¸€çš„ã€Œå´é¢åƒã€åœ‹ç‹ï¼ˆKingï¼‰æ˜¯å“ªç¨®èŠ±è‰²ï¼Ÿ", options: ["é»‘æ¡ƒ", "ç´…å¿ƒ", "æ–¹å¡Š", "æ¢…èŠ±"], ans: 2 },
        { q: "ç¶²çƒæ¯”è³½ä¸­ï¼Œä¸€å±€è‹¥æ¯”åˆ†ç‚ºã€Œ40-40ã€ï¼Œè¡“èªç¨±ç‚ºä»€éº¼ï¼Ÿ", options: ["Love", "Deuce", "Ace", "Match Point"], ans: 1 },
        { q: "ä¸‹åˆ—å“ªä¸€ç¨®é£Ÿç‰©å¯Œå«ç¶­ç”Ÿç´ Cï¼Ÿ", options: ["ç‰›è‚‰", "å¥‡ç•°æœ", "ç™½é£¯", "è±†è…"], ans: 1 },
        { q: "æ‰‹æ©Ÿé€šè¨ŠæŠ€è¡“ã€Œ5Gã€çš„ã€ŒGã€ä»£è¡¨ä»€éº¼æ„æ€ï¼Ÿ", options: ["Global", "Generation", "Gigabit", "Grade"], ans: 1 },
        { q: "åœ‹éš›æ±‚æ•‘è¨Šè™Ÿã€ŒSOSã€çš„æ‘©æ–¯å¯†ç¢¼çµ„åˆæ˜¯ï¼Ÿ", options: ["ä¸‰çŸ­ä¸‰é•·ä¸‰çŸ­", "ä¸‰é•·ä¸‰çŸ­ä¸‰é•·", "ä¸€é•·ä¸€çŸ­", "å…©çŸ­å…©é•·"], ans: 0 },
        { q: "ä¸€èˆ¬æƒ…æ³ä¸‹ï¼Œè­·ç…§çš„æœ‰æ•ˆæœŸé€šå¸¸ç‚ºå¹¾å¹´ï¼Ÿ", options: ["3å¹´", "5å¹´", "10å¹´", "20å¹´"], ans: 2 }
    ],
    king_art: [
        { q: "åç•«ã€Šè’™å¨œéº—èã€‹çš„ä½œè€…æ˜¯èª°ï¼Ÿ", options: ["æ¢µè°·", "ç•¢å¡ç´¢", "é”æ–‡è¥¿", "ç±³é–‹æœ—åŸºç¾…"], ans: 2 },
        { q: "ã€Œå“ˆåˆ©æ³¢ç‰¹ã€ç³»åˆ—çš„ä½œè€…æ˜¯ï¼Ÿ", options: ["J.K.ç¾…ç³", "æ‰˜çˆ¾é‡‘", "å²è’‚èŠ¬Â·é‡‘", "å–¬æ²»Â·RÂ·RÂ·é¦¬ä¸"], ans: 0 },
        { q: "ä¸­åœ‹å¤ä»£å››å¤§åè‘—ä¸åŒ…å«ä¸‹åˆ—å“ªä¸€éƒ¨ï¼Ÿ", options: ["è¥¿éŠè¨˜", "æ°´æ»¸å‚³", "é‡‘ç“¶æ¢…", "ç´…æ¨“å¤¢"], ans: 2 },
        { q: "æˆèªã€Œå›«åœ‡åæ£—ã€ä¸­çš„ã€Œå›«åœ‡ã€æ˜¯ä»€éº¼æ„æ€ï¼Ÿ", options: ["å¿«é€Ÿ", "å®Œæ•´", "é£¢é¤“", "æ··äº‚"], ans: 1 },
        { q: "è‘—åé›•åƒã€Œå¤§è¡›åƒã€æ˜¯èª°çš„ä½œå“ï¼Ÿ", options: ["ç¾…ä¸¹", "é”æ–‡è¥¿", "ç±³é–‹æœ—åŸºç¾…", "æ‹‰æ–çˆ¾"], ans: 2 },
        { q: "ã€ŒTo be, or not to beã€æ˜¯èå£«æ¯”äºå“ªéƒ¨æˆ²åŠ‡çš„åå¥ï¼Ÿ", options: ["ç¾…å¯†æ­èˆ‡èŒ±éº—è‘‰", "å“ˆå§†é›·ç‰¹", "é¦¬å…‹ç™½", "æçˆ¾ç‹"], ans: 1 },
        { q: "è¢«ç¨±ç‚ºã€ŒéŸ³æ¨‚ç¥ç«¥ã€çš„ä½œæ›²å®¶æ˜¯ï¼Ÿ", options: ["è²å¤šèŠ¬", "å·´å“ˆ", "è«æœ­ç‰¹", "è•­é‚¦"], ans: 2 },
        { q: "è«¾è²çˆ¾æ–‡å­¸çå¾—ä¸»è«è¨€æ˜¯å“ªåœ‹äººï¼Ÿ", options: ["æ—¥æœ¬", "ä¸­åœ‹", "éŸ“åœ‹", "æ–°åŠ å¡"], ans: 1 },
        { q: "é›»å½±ã€Šé­”æˆ’ã€‹ä¸‰éƒ¨æ›²çš„å°æ¼”æ˜¯ï¼Ÿ", options: ["å²è’‚èŠ¬å²åŒ¹æŸ", "è©¹å§†æ–¯å¡éº¥éš†", "å½¼å¾—å‚‘å…‹æ£®", "å…‹é‡Œæ–¯å¤šç¦è«¾è˜­"], ans: 2 },
        { q: "æˆèªã€Œç½„ç«¹é›£æ›¸ã€åŸæœ¬æ˜¯ç”¨ä¾†å½¢å®¹ï¼Ÿ", options: ["åŠŸå¾·ç„¡é‡", "ç½ªæƒ¡æ¥µå¤š", "æ–‡ç« å„ªç¾", "æ›¸æ³•è‰ç‡"], ans: 1 }
    ]
};

// ==========================================
//  3. éŠæˆ²é‚è¼¯æ ¸å¿ƒ (Logic Layer)
// ==========================================

let studentInfo = { className: "", seatNo: "" };
let currentSubject = '';
let currentQuestionIndex = 0;
let score = 0;
// ğŸ² è®Šæ•¸ï¼šç”¨ä¾†å­˜ç•¶ä¸‹é€™å ´éŠæˆ²è¢«æ´—äº‚å¾Œçš„é¡Œç›®
let currentSessionQuestions = []; 

// --- ç™»å…¥åŠŸèƒ½ ---
function login() {
    const classVal = document.getElementById('class-select').value;
    const seatVal = document.getElementById('seat-select').value;
    
    if (!classVal || !seatVal) {
        alert("è«‹ç¢ºèªç­ç´šå’Œåº§è™Ÿéƒ½æœ‰é¸æ“‡å–”ï¼");
        return;
    }
    
    studentInfo.className = classVal;
    studentInfo.seatNo = seatVal;

    // éš±è—ç™»å…¥é ï¼Œé¡¯ç¤ºä¸»é¸å–®
    document.getElementById('login-screen').classList.add('hidden');
    document.getElementById('menu-screen').classList.remove('hidden');
}

// --- åˆ‡æ›åˆ°çŸ¥è­˜ç‹é¸å–® ---
function showKingMenu() {
    document.getElementById('menu-screen').classList.add('hidden');
    document.getElementById('king-menu-screen').classList.remove('hidden');
}

// --- å¾çŸ¥è­˜ç‹é¸å–®è¿”å›å¤§å»³ ---
function showMenuFromKing() {
    document.getElementById('king-menu-screen').classList.add('hidden');
    document.getElementById('menu-screen').classList.remove('hidden');
}

// --- ğŸ² æ´—ç‰Œæ¼”ç®—æ³• ---
function shuffleArray(array) {
    if (!array) return [];
    let newArray = [...array]; 
    for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
    }
    return newArray;
}

// --- å•Ÿå‹•éŠæˆ² ---
function startGame(subject) {
    currentSubject = subject;
    currentQuestionIndex = 0;
    score = 0;
    
    // æª¢æŸ¥é¡Œç›®
    if (!questionBank[subject] || questionBank[subject].length === 0) {
        alert("ğŸš§ è€å¸«é‚„åœ¨åŠªåŠ›å‡ºé¡Œä¸­ï¼Œè«‹ç¨å¾Œå†ä¾†ï¼");
        return;
    }

    // æ´—ç‰Œ
    currentSessionQuestions = shuffleArray(questionBank[subject]);

    // åˆ‡æ›ç•«é¢
    document.getElementById('menu-screen').classList.add('hidden');
    document.getElementById('king-menu-screen').classList.add('hidden');
    document.getElementById('game-screen').classList.remove('hidden');
    
    document.getElementById('subject-title').innerText = getSubjectName(subject);
    document.getElementById('score').innerText = score;
    
    loadQuestion();
}

// --- è¼‰å…¥é¡Œç›® ---
function loadQuestion() {
    const data = currentSessionQuestions[currentQuestionIndex];
    
    document.getElementById('question-text').innerText = `Q${currentQuestionIndex + 1}: ${data.q}`;
    
    const optionsDiv = document.getElementById('options-container');
    optionsDiv.innerHTML = ''; 
    document.getElementById('feedback').classList.add('hidden');
    document.getElementById('next-btn').classList.add('hidden');

    data.options.forEach((opt, index) => {
        const btn = document.createElement('button');
        btn.innerText = opt;
        btn.onclick = () => checkAnswer(index, btn);
        optionsDiv.appendChild(btn);
    });
}

// --- æª¢æŸ¥ç­”æ¡ˆ ---
function checkAnswer(selectedIndex, btnElement) {
    const data = currentSessionQuestions[currentQuestionIndex];
    const correctIndex = data.ans;
    const feedbackBox = document.getElementById('feedback');

    const allBtns = document.querySelectorAll('#options-container button');
    allBtns.forEach(btn => btn.disabled = true);

    if (selectedIndex === correctIndex) {
        btnElement.classList.add('correct');
        feedbackBox.innerText = "ğŸ‰ ç­”å°äº†ï¼å¤ªå¼·äº†å§ï¼";
        feedbackBox.className = "feedback-box correct"; 
        score += 10;
    } else {
        btnElement.classList.add('wrong');
        allBtns[correctIndex].classList.add('correct'); 
        feedbackBox.innerText = "ğŸ˜… å“å‘€ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯: " + data.options[correctIndex];
        feedbackBox.className = "feedback-box wrong";
    }
    
    document.getElementById('score').innerText = score;
    feedbackBox.classList.remove('hidden');
    document.getElementById('next-btn').classList.remove('hidden');
}

// --- ä¸‹ä¸€é¡Œ ---
function nextQuestion() {
    currentQuestionIndex++;
    if (currentQuestionIndex < currentSessionQuestions.length) {
        loadQuestion();
    } else {
        sendScoreToGoogleSheet();
    }
}

// --- å‚³é€æˆç¸¾ ---
function sendScoreToGoogleSheet() {
    alert(`ğŸ† æ­å–œå®Œæˆï¼ä½ çš„å¾—åˆ†æ˜¯ï¼š${score} åˆ†\næ­£åœ¨ä¸Šå‚³æˆç¸¾...`);

    const data = {
        className: studentInfo.className,
        seatNo: studentInfo.seatNo,
        subject: getSubjectName(currentSubject),
        score: score
    };

    fetch(GOOGLE_SCRIPT_URL, {
        method: 'POST',
        body: JSON.stringify(data),
        mode: 'no-cors',
        headers: { 'Content-Type': 'text/plain' }
    }).then(() => {
        alert("âœ… æˆç¸¾å·²æˆåŠŸå‚³é€çµ¦çƒˆç”«è€å¸«ï¼");
        showMenu();
    }).catch(err => {
        alert("âŒ å‚³é€å¤±æ•—ï¼Œè«‹æˆªåœ–çµ¦è€å¸«çœ‹ï¼š" + err);
        showMenu();
    });
}

// --- è¿”å›é¸å–® ---
function showMenu() {
    document.getElementById('game-screen').classList.add('hidden');
    document.getElementById('king-menu-screen').classList.add('hidden');
    document.getElementById('menu-screen').classList.remove('hidden');
}

// --- è¼”åŠ©ï¼šå–å¾—ä¸­æ–‡ç§‘ç›®åç¨± (é€™è£¡å°±æ˜¯ä¹‹å‰æ–·æ‰çš„åœ°æ–¹ï¼ç¾åœ¨è£œå¥½äº†) ---
function getSubjectName(key) {
    const map = {
        chinese: 'åœ‹èª', math: 'æ•¸å­¸', nature: 'è‡ªç„¶', social: 'ç¤¾æœƒ',
        english: 'è‹±èª', eng1200: 'è‹±èª1200', tang: 'å”è©©', 
        lang_king: 'èªæ–‡çŸ¥è­˜ç‹', geo_king: 'åœ°ç†ç‹',
        king_geo: 'çŸ¥è­˜ç‹-åœ°ç†', king_hist: 'çŸ¥è­˜ç‹-æ­·å²', 
        king_sci: 'çŸ¥è­˜ç‹-è‡ªç„¶', king_life: 'çŸ¥è­˜ç‹-å¸¸è­˜', king_art: 'çŸ¥è­˜ç‹-è—æ–‡'
    };
    return map[key] || key;
}